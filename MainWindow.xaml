<Window x:Class="AI.KB.Assistant.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:AI.KB.Assistant.Helpers"
        Title="AI 知識庫助手" Height="720" Width="1200"
        Background="#0b1220" Foreground="#f4f4f4">

    <!-- 全域資源 -->
    <Window.Resources>
        <!-- Unix 秒數 → yyyy-MM-dd -->
        <local:UnixToDateConverter x:Key="UnixToDateConverter"/>

        <!-- 搜尋框浮水印樣式 -->
        <Style x:Key="WatermarkTextBox" TargetType="TextBox">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Grid>
                            <ScrollViewer x:Name="PART_ContentHost"/>
                            <TextBlock Text="{TemplateBinding Tag}"
                         Margin="6,0,0,0"
                         Foreground="#6f7a94"
                         VerticalAlignment="Center"
                         IsHitTestVisible="False"
                         Visibility="Collapsed"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="Text" Value="">
                                <Setter Property="Visibility" TargetName="TextBlock" Value="Visible"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ListView 項目樣式 + 右鍵選單 -->
        <Style TargetType="ListViewItem">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="#0f1628"/>
            <Setter Property="ContextMenu">
                <Setter.Value>
                    <ContextMenu>
                        <MenuItem Header="📄 開啟檔案" Click="OpenFile_Click"/>
                        <MenuItem Header="📂 開啟資料夾" Click="OpenFolder_Click"/>
                        <Separator/>
                        <MenuItem Header="🔗 複製路徑" Click="CopyPath_Click"/>
                    </ContextMenu>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <DockPanel>

        <!-- 底部狀態列 -->
        <StatusBar DockPanel.Dock="Bottom" Background="#0f1628" Foreground="#cfe3ff">
            <StatusBarItem>
                <TextBlock x:Name="TxtStatus" Text="就緒"/>
            </StatusBarItem>
        </StatusBar>

        <!-- 側邊欄 -->
        <StackPanel DockPanel.Dock="Left" Width="260" Background="#111a2b">
            <TextBlock Text="AI 知識庫側欄" Margin="12" Foreground="White" FontWeight="Bold"/>

            <TextBlock Text="總目錄" Margin="12,6,12,0" Foreground="#cfe3ff"/>
            <TreeView Name="TreeCategories" Margin="8"/>

            <Separator Margin="8"/>

            <!-- 搜尋（在最近新增上方） -->
            <TextBlock Text="搜尋" Margin="12,4,12,0" Foreground="#cfe3ff"/>
            <StackPanel Orientation="Horizontal" Margin="8">
                <TextBox Name="SearchBox" Width="160" Margin="0,0,8,0"
                 Style="{StaticResource WatermarkTextBox}"
                 Tag="輸入關鍵字…"
                 KeyDown="SearchBox_KeyDown"/>
                <Button Name="BtnSearch" Content="🔍" Width="44" Click="BtnSearch_Click"/>
            </StackPanel>

            <!-- 快速視圖 -->
            <Button Name="BtnRecent"   Content="🆕 最近新增" Margin="8" Click="BtnRecent_Click"/>
            <Button Name="BtnPending"  Content="📝 待確認"   Margin="8" Click="BtnPending_Click"/>
            <Button Name="BtnProgress" Content="🚀 執行中"   Margin="8" Click="BtnProgress_Click"/>
            <Button Name="BtnTodo"     Content="✅ 代辦"     Margin="8" Click="BtnTodo_Click"/>
            <Button Name="BtnSettings" Content="⚙️ 設定"     Margin="8" Click="BtnSettings_Click"/>
        </StackPanel>

        <!-- 主區域 -->
        <DockPanel>

            <!-- 上方工具列 -->
            <StackPanel Orientation="Horizontal" Margin="8" DockPanel.Dock="Top">
                <CheckBox Name="ChkDryRun" Content="乾跑" Margin="0" IsChecked="True"/>
                <Button Name="BtnConfirmMove" Content="🟢 一鍵確認並搬檔"
                Margin="12,0,0,0" Click="BtnConfirmMove_Click"/>
            </StackPanel>

            <!-- 拖放收件匣 -->
            <Border x:Name="DropZone"
              Margin="8" BorderBrush="#2e7cf6" BorderThickness="1" Padding="16"
              Background="#0f1628" CornerRadius="8"
              AllowDrop="True" Drop="DropInbox"
              DragEnter="DropZone_DragEnter" DragLeave="DropZone_DragLeave"
              DockPanel.Dock="Top">
                <TextBlock Foreground="#cfe3ff" FontSize="16"
                   Text="把檔案拖進來（收件匣）" HorizontalAlignment="Center" VerticalAlignment="Center" />
            </Border>

            <!-- 清單標題 -->
            <TextBlock x:Name="TxtHeader" Margin="12,0,12,0" Foreground="#cfe3ff" DockPanel.Dock="Top" />

            <!-- 清單（三欄：檔名 / 類別 / 日期） -->
            <ListView x:Name="ListFiles" Margin="8" SelectionMode="Extended"
                VirtualizingPanel.IsVirtualizing="True"
                ScrollViewer.CanContentScroll="True">
                <ListView.View>
                    <GridView>
                        <GridViewColumn Header="檔名" DisplayMemberBinding="{Binding Filename}" Width="520"/>
                        <GridViewColumn Header="類別" DisplayMemberBinding="{Binding Category}" Width="200"/>
                        <GridViewColumn Header="日期">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding CreatedTs, Converter={StaticResource UnixToDateConverter}}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                    </GridView>
                </ListView.View>
            </ListView>

        </DockPanel>
    </DockPanel>
</Window>
