<Window x:Class="AI.KB.Assistant.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="設定"
        Height="780" Width="980"
        WindowStartupLocation="CenterOwner">

    <!-- ========== Styles / Resources ========== -->
    <Window.Resources>
        <!-- 群組內統一行高/留白 -->
        <Style x:Key="FormLabel" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,8,0,0"/>
        </Style>

        <Style x:Key="HintText" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{DynamicResource App.TextMutedBrush}"/>
            <Setter Property="Margin" Value="0,4,0,10"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
        </Style>

        <!-- 讓 TextBox 有較舒服的高度 -->
        <Style TargetType="TextBox">
            <Setter Property="Height" Value="28"/>
        </Style>
    </Window.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="16" Orientation="Vertical" >

            <!-- 一、一般設定 -->
            <GroupBox Header="一般" Margin="0,0,0,12">
                <StackPanel Margin="12" Orientation="Vertical" >

                    <!-- 資料庫路徑 -->
                    <TextBlock Text="資料庫路徑" Style="{StaticResource FormLabel}"/>
                    <Grid Margin="0,6,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="TxtDbPath" Grid.Column="0" MinWidth="520" />
                        <Button Grid.Column="1" Content="瀏覽" Padding="12,6" Margin="8,0,0,0" Click="BtnPickDbPath_Click"/>
                    </Grid>
                    <TextBlock Text="儲存檔案索引（標籤、狀態、專案等）的 SQLite 檔案位置。"
                               Style="{StaticResource HintText}"/>

                    <!-- 專案根目錄 -->
                    <TextBlock Text="專案根目錄" Style="{StaticResource FormLabel}"/>
                    <Grid Margin="0,6,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="TxtRootDir" Grid.Column="0" MinWidth="520" />
                        <Button Grid.Column="1" Content="瀏覽" Padding="12,6" Margin="8,0,0,0" Click="BtnPickRootDir_Click"/>
                    </Grid>
                    <TextBlock Text="自動整理與分類後的檔案會在此根目錄下產生層級資料夾（年份／月份／類別／專案等）。"
                               Style="{StaticResource HintText}"/>
                    <TextBlock Text="另外，『信心不足』的檔案會放在此根目錄下的「信心不足」資料夾中，不參與深度分類。"
                               Style="{StaticResource HintText}"/>

                </StackPanel>
            </GroupBox>

            <!-- 二、匯入 / 收件夾 -->
            <GroupBox Header="匯入 / 收件夾" Margin="0,0,0,12">
                <StackPanel Margin="12" Orientation="Vertical">

                    <!-- 拖放 / 子資料夾 -->
                    <StackPanel Orientation="Vertical">
                        <CheckBox x:Name="CbAutoOnDrop" Content="拖放到主視窗時，自動加入收件夾（Inbox）" Margin="0,0,0,4"/>
                        <TextBlock Text="將檔案拖入主視窗時，自動建立 DB 紀錄並放入收件狀態，方便後續檢視分類。"
                                   Style="{StaticResource HintText}" Margin="22,0,0,10"/>
                        <CheckBox x:Name="CbIncludeSubdir" Content="加入資料夾時包含子資料夾" />
                        <TextBlock Text="勾選後，加入整個資料夾時會遞迴掃描子資料夾中的檔案。"
                                   Style="{StaticResource HintText}" Margin="22,0,0,10"/>
                    </StackPanel>

                    <!-- HotFolder -->
                    <TextBlock Text="收件夾（HotFolder）" Style="{StaticResource FormLabel}"/>
                    <Grid Margin="0,6,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="TxtHotFolder" Grid.Column="0" MinWidth="520"/>
                        <Button Grid.Column="1" Content="瀏覽" Padding="12,6" Margin="8,0,0,0" Click="BtnPickHotFolder_Click"/>
                    </Grid>
                    <TextBlock Text="指定一個『收件夾』捷徑，便於手動將檔案放入。此資料夾會在主頁與樹狀捷徑中同步顯示。"
                               Style="{StaticResource HintText}"/>

                    <!-- 搬檔模式 / 覆蓋策略 -->
                    <TextBlock Text="搬檔模式與覆蓋策略" Style="{StaticResource FormLabel}"/>
                    <WrapPanel Margin="0,6,0,0" ItemWidth="300">
                        <StackPanel Width="280">
                            <TextBlock Text="搬檔模式"/>
                            <ComboBox x:Name="CbMoveMode" Margin="0,6,12,0">
                                <ComboBoxItem Content="搬移（Move）"/>
                                <ComboBoxItem Content="複製（Copy）"/>
                            </ComboBox>
                            <TextBlock Text="搬移：將原檔移動到目標路徑。複製：保留原檔並複製一份到目標路徑。"
                                       Style="{StaticResource HintText}"/>
                        </StackPanel>

                        <StackPanel Width="320">
                            <TextBlock Text="覆蓋策略"/>
                            <ComboBox x:Name="CbOverwritePolicy" Margin="0,6,0,0">
                                <ComboBoxItem Content="覆蓋（Replace）"/>
                                <ComboBoxItem Content="重新命名（Rename）"/>
                                <ComboBoxItem Content="略過（Skip）"/>
                            </ComboBox>
                            <TextBlock Text="覆蓋：目標同名檔案將被覆蓋。重新命名：在目標自動加序號避免衝突。略過：保持原狀，不處理。"
                                       Style="{StaticResource HintText}"/>
                        </StackPanel>
                    </WrapPanel>

                    <!-- 黑名單（資料夾名） -->
                    <TextBlock Text="黑名單資料夾名（多個以逗號或換行分隔）" Style="{StaticResource FormLabel}"/>
                    <TextBox x:Name="TxtBlacklistFolders" Height="80" AcceptsReturn="True" VerticalScrollBarVisibility="Auto"/>
                    <TextBlock Text="遇到名稱在黑名單中的資料夾將被忽略，不會納入自動分類與搬檔流程。"
                               Style="{StaticResource HintText}"/>

                    <!-- 黑名單（副檔名） -->
                    <TextBlock Text="黑名單副檔名（不含點，逗號或換行分隔）" Style="{StaticResource FormLabel}"/>
                    <TextBox x:Name="TxtBlacklistExts" Height="60" AcceptsReturn="True" VerticalScrollBarVisibility="Auto"/>
                    <TextBlock Text="這些副檔名的檔案將不會被加入或搬運（例如 tmp、log 等暫存檔）。"
                               Style="{StaticResource HintText}"/>
                </StackPanel>
            </GroupBox>

            <!-- 三、路徑模板 -->
            <GroupBox Header="路徑模板" Margin="0,0,0,12">
                <StackPanel Margin="12" Orientation="Vertical">
                    <TextBlock Text="用來組合自動整理後的層級（位於『專案根目錄』下）。" 
                               Style="{StaticResource HintText}" Margin="0,0,0,6"/>
                    <WrapPanel Margin="0,4,0,0">
                        <CheckBox x:Name="CbUseYear"   Content="年份（yyyy）" Margin="0,0,16,0"/>
                        <CheckBox x:Name="CbUseMonth"  Content="月份（MM）"   Margin="0,0,16,0"/>
                        <CheckBox x:Name="CbUseProject" Content="專案"       Margin="0,0,16,0"/>
                        <CheckBox x:Name="CbUseType"    Content="型態/類別"/>
                    </WrapPanel>
                    <TextBlock Text="若未使用 LLM 產生專案名，系統會先以『yyyyMM』作為專案名稱。"
                               Style="{StaticResource HintText}" Margin="0,4,0,0"/>
                </StackPanel>
            </GroupBox>

            <!-- 四、LLM -->
            <GroupBox Header="LLM" Margin="0,0,0,12">
                <StackPanel Margin="12">
                    <TextBlock Text="API Key" Style="{StaticResource FormLabel}"/>
                    <PasswordBox x:Name="TxtApiKey" Margin="0,6,0,0"/>
                    <TextBlock Text="用於呼叫文字模型（例如產生專案名稱或摘要）。"
                               Style="{StaticResource HintText}"/>

                    <TextBlock Text="Model" Style="{StaticResource FormLabel}"/>
                    <TextBox x:Name="TxtModel" Margin="0,6,0,0"/>
                    <TextBlock Text="指定要使用的模型名稱。"
                               Style="{StaticResource HintText}"/>

                    <CheckBox x:Name="CbLmLowConf" Content="僅在低信心時啟用" />
                    <TextBlock Text="只有當系統無法以規則高信心判斷時，才會輔助請模型產生建議。"
                               Style="{StaticResource HintText}" Margin="22,0,0,0"/>
                </StackPanel>
            </GroupBox>

            <!-- 五、Extension Groups 檢視 / 匯入 -->
            <GroupBox Header="Extension Groups 檢視 / 匯入" Margin="0,0,0,12">
                <StackPanel Margin="12">
                    <TextBlock Text="檢視/編輯副檔名到類別的對應表。格式為 JSON。"
                               Style="{StaticResource HintText}" Margin="0,0,0,8"/>
                    <WrapPanel Margin="0,0,0,8">
                        <Button x:Name="BtnLoadExtGroups" Content="從檔案匯入 JSON…" Padding="10,6" Margin="0,0,6,0"/>
                        <Button x:Name="BtnApplyExtGroups" Content="套用到設定" Padding="10,6" Margin="0,0,6,0"/>
                        <Button x:Name="BtnResetExtGroups" Content="重置為預設" Padding="10,6"/>
                    </WrapPanel>
                    <TextBox x:Name="TxtExtGroups"
                             AcceptsReturn="True"
                             VerticalScrollBarVisibility="Auto"
                             HorizontalScrollBarVisibility="Auto"
                             FontFamily="Consolas"
                             Height="220"
                             TextWrapping="NoWrap"/>
                    <TextBlock Text="已將 JSON 排版成較緊湊的單行陣列格式，方便視覺瀏覽。"
                               Style="{StaticResource HintText}" Margin="0,6,0,0"/>
                </StackPanel>
            </GroupBox>

            <!-- 動作列 -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button x:Name="BtnOk" Content="確定" Width="100" Margin="0,0,8,0" Click="BtnOk_Click"/>
                <Button Content="取消" Width="100" IsCancel="True"/>
            </StackPanel>

        </StackPanel>
    </ScrollViewer>
</Window>
