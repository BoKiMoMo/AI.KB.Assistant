<Window x:Class="AI.KB.Assistant.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="設定 - AI.KB Assistant"
        Height="720" Width="980"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource App.BackgroundBrush}"
        Foreground="{DynamicResource App.TextBrush}">

    <!-- ===== Styles ===== -->
    <Window.Resources>
        <!-- 卡片樣式 -->
        <Style x:Key="Card" TargetType="GroupBox">
            <Setter Property="Margin" Value="0,0,0,12"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Background" Value="{DynamicResource App.PanelBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource App.BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GroupBox">
                        <DockPanel>
                            <Border DockPanel.Dock="Top"
                                    Background="{DynamicResource App.PanelBrush}"
                                    BorderBrush="{DynamicResource App.BorderBrush}"
                                    BorderThickness="0,0,0,1"
                                    Padding="8,6">
                                <ContentPresenter ContentSource="Header"
                                                  RecognizesAccessKey="True"
                                                  Margin="0"
                                                  />
                            </Border>
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="0">
                                <ContentPresenter Margin="0"/>
                            </Border>
                        </DockPanel>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 標籤欄寬 -->
        <Style x:Key="FormLabel" TargetType="TextBlock">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
            <Setter Property="Width" Value="160"/>
        </Style>

        <!-- 輸入框 -->
        <Style x:Key="FormInput" TargetType="Control">
            <Setter Property="MinWidth" Value="280"/>
        </Style>

        <Style x:Key="TightButton" TargetType="Button">
            <Setter Property="Margin" Value="8,0,0,0"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="BorderBrush" Value="{DynamicResource App.BorderBrush}"/>
            <Setter Property="Background" Value="{DynamicResource App.PanelBrush}"/>
        </Style>
    </Window.Resources>

    <DockPanel>
        <!-- Header -->
        <Border DockPanel.Dock="Top"
                Background="{DynamicResource App.PanelBrush}"
                BorderBrush="{DynamicResource App.BorderBrush}"
                BorderThickness="0,0,0,1">
            <Grid Margin="12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="應用程式設定"
                           FontSize="18" FontWeight="Bold"
                           VerticalAlignment="Center"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button x:Name="BtnReload" Content="重新載入"
                            Click="BtnReload_Click" Style="{StaticResource TightButton}"/>
                    <Button x:Name="BtnCancel" Content="取消"
                            Click="BtnCancel_Click" Style="{StaticResource TightButton}"/>
                    <Button x:Name="BtnSave" Content="儲存"
                            Click="BtnSave_Click" Style="{StaticResource TightButton}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Content -->
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="12" >

                <!-- 1. 路徑設定 -->
                <GroupBox Header="路徑設定" Style="{StaticResource Card}">
                    <StackPanel>
                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="170"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Root 目的地" Style="{StaticResource FormLabel}"/>
                            <TextBox x:Name="TbRootDir" Grid.Column="1" MinWidth="420"/>
                            <Button x:Name="BtnBrowseRoot" Grid.Column="2" Content="瀏覽..."
                                    Click="BtnBrowseRoot_Click" Style="{StaticResource TightButton}"/>
                        </Grid>

                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="170"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="收件夾 (HotFolder)" Style="{StaticResource FormLabel}"/>
                            <TextBox x:Name="TbHotFolder" Grid.Column="1" MinWidth="420"/>
                            <Button x:Name="BtnBrowseHot" Grid.Column="2" Content="瀏覽..."
                                    Click="BtnBrowseHot_Click" Style="{StaticResource TightButton}"/>
                        </Grid>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="170"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="資料庫 (SQLite)" Style="{StaticResource FormLabel}"/>
                            <TextBox x:Name="TbDbPath" Grid.Column="1" MinWidth="420"/>
                            <Button x:Name="BtnBrowseDb" Grid.Column="2" Content="選擇檔案..."
                                    Click="BtnBrowseDb_Click" Style="{StaticResource TightButton}"/>
                        </Grid>
                    </StackPanel>
                </GroupBox>

                <!-- 2. 匯入策略 -->
                <GroupBox Header="匯入策略" Style="{StaticResource Card}">
                    <StackPanel>
                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="170"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="包含子資料夾" Style="{StaticResource FormLabel}"/>
                            <CheckBox x:Name="CbIncludeSubdir" Grid.Column="1" VerticalAlignment="Center" Content="啟用"/>
                        </Grid>

                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="170"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="啟用 HotFolder 監聽" Style="{StaticResource FormLabel}"/>
                            <CheckBox x:Name="CbEnableHotFolder" Grid.Column="1" VerticalAlignment="Center" Content="啟用"/>
                        </Grid>

                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="170"/>
                                <ColumnDefinition Width="220"/>
                                <ColumnDefinition Width="170"/>
                                <ColumnDefinition Width="220"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="加入方式" Style="{StaticResource FormLabel}"/>
                            <ComboBox x:Name="CbMoveMode" Grid.Column="1">
                                <ComboBoxItem Content="只入庫 (StageOnly)"/>
                                <ComboBoxItem Content="複製 (Copy)"/>
                                <ComboBoxItem Content="移動 (Move)"/>
                            </ComboBox>

                            <TextBlock Grid.Column="2" Text="檔名衝突策略" Style="{StaticResource FormLabel}"/>
                            <ComboBox x:Name="CbOverwrite" Grid.Column="3">
                                <ComboBoxItem Content="略過 (Skip)"/>
                                <ComboBoxItem Content="覆蓋 (Replace)"/>
                                <ComboBoxItem Content="改名 (Rename)"/>
                            </ComboBox>
                        </Grid>

                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="170"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="黑名單副檔名（, 分隔）" Style="{StaticResource FormLabel}"/>
                            <TextBox x:Name="TbBlacklistExts" Grid.Column="1" AcceptsReturn="True" Height="64" TextWrapping="Wrap"/>
                        </Grid>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="170"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="黑名單資料夾（, 分隔）" Style="{StaticResource FormLabel}"/>
                            <TextBox x:Name="TbBlacklistFolders" Grid.Column="1" AcceptsReturn="True" Height="64" TextWrapping="Wrap"/>
                        </Grid>
                    </StackPanel>
                </GroupBox>

                <!-- 3. 路徑邏輯 -->
                <GroupBox Header="路徑邏輯" Style="{StaticResource Card}">
                    <StackPanel>
                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="170"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="路徑層級" Style="{StaticResource FormLabel}"/>
                            <StackPanel Grid.Column="1" Orientation="Horizontal" >
                                <CheckBox x:Name="CbUseYear" Content="年份層" Margin="0,0,12,0"/>
                                <CheckBox x:Name="CbUseMonth" Content="月份層" Margin="0,0,12,0"/>
                                <CheckBox x:Name="CbUseProject" Content="專案層" Margin="0,0,12,0"/>
                                <CheckBox x:Name="CbUseType" Content="類型層"/>
                            </StackPanel>
                        </Grid>

                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="170"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="自動整理資料夾名稱" Style="{StaticResource FormLabel}"/>
                            <TextBox x:Name="TbAutoFolder" Grid.Column="1"/>
                        </Grid>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="170"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="低信心資料夾名稱" Style="{StaticResource FormLabel}"/>
                            <TextBox x:Name="TbLowConfidence" Grid.Column="1"/>
                        </Grid>
                    </StackPanel>
                </GroupBox>

                <!-- 4. AI 參數 -->
                <GroupBox Header="AI 參數" Style="{StaticResource Card}">
                    <StackPanel>
                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="170"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="60"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="分類信心門檻" Style="{StaticResource FormLabel}"/>
                            <Slider x:Name="SlThreshold" Grid.Column="1" Minimum="0" Maximum="1" TickFrequency="0.05" IsSnapToTickEnabled="True"/>
                            <TextBlock Grid.Column="2" VerticalAlignment="Center" Text="{Binding ElementName=SlThreshold, Path=Value, StringFormat={}{0:0.00}}"/>
                        </Grid>

                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="170"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="OpenAI API Key" Style="{StaticResource FormLabel}"/>
                            <PasswordBox x:Name="TbApiKey" Grid.Column="1"/>
                        </Grid>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="170"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Model" Style="{StaticResource FormLabel}"/>
                            <TextBox x:Name="TbModel" Grid.Column="1" Text="gpt-4o-mini"/>
                        </Grid>
                    </StackPanel>
                </GroupBox>

                <!-- 底部提示 -->
                <Border Background="{DynamicResource App.BannerInfoBrush}"
                        BorderBrush="{DynamicResource App.BorderBrush}"
                        BorderThickness="1" Padding="10">
                    <TextBlock Text="提示：儲存後將立即套用，部分設定需回到主畫面重新整理生效。"
                               TextWrapping="Wrap"/>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </DockPanel>
</Window>
