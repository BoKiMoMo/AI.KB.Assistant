<Window x:Class="AI.KB.Assistant.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="設定" Height="840" Width="980"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource App.BackgroundBrush}"
        Foreground="{DynamicResource App.TextBrush}">

    <Window.Resources>
        <!-- 左標籤/右內容用的表單欄寬 -->
        <Style x:Key="FormGrid" TargetType="Grid">
            <Setter Property="Margin" Value="12"/>
            <Setter Property="ColumnDefinitions">
                <Setter.Value>
                    <ColumnDefinitionCollection>
                        <ColumnDefinition Width="170"/>
                        <ColumnDefinition Width="*"/>
                    </ColumnDefinitionCollection>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 灰色說明文字：自動換行、不會被擋住 -->
        <Style x:Key="HintText" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{DynamicResource App.TextMutedBrush}"/>
            <Setter Property="FontSize"   Value="12"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="Margin" Value="0,6,0,0"/>
        </Style>

        <!-- 欄位之間的垂直空距 -->
        <Thickness x:Key="FieldMargin">8,4</Thickness>
    </Window.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="12">
        <StackPanel Orientation="Vertical" >

            <!-- 一、一般 -->
            <GroupBox Header="一般" Margin="0,0,0,12">
                <Grid Style="{StaticResource FormGrid}">
                    <!-- 0: DB 路徑 -->
                    <TextBlock Grid.Row="0" Grid.Column="0" Text="資料庫路徑：" VerticalAlignment="Center"/>
                    <DockPanel Grid.Row="0" Grid.Column="1" Margin="{StaticResource FieldMargin}">
                        <TextBox x:Name="TxtDbPath" Margin="0,0,8,0"/>
                        <Button Content="瀏覽…" Click="BtnPickDbPath_Click" Style="{StaticResource TonedBtn}" MinWidth="76"/>
                    </DockPanel>
                    <TextBlock Grid.Row="1" Grid.ColumnSpan="2"
                               Text="SQLite 檔案位置，預設 data.db。建議放在程式可寫入的位置。"
                               Style="{StaticResource HintText}"/>

                    <!-- 2: 根目錄 -->
                    <TextBlock Grid.Row="2" Grid.Column="0" Text="專案根目錄：" VerticalAlignment="Center"/>
                    <DockPanel Grid.Row="2" Grid.Column="1" Margin="{StaticResource FieldMargin}">
                        <TextBox x:Name="TxtRootDir" Margin="0,0,8,0"/>
                        <Button Content="瀏覽…" Click="BtnPickRootDir_Click" Style="{StaticResource TonedBtn}" MinWidth="76"/>
                    </DockPanel>
                    <TextBlock Grid.Row="3" Grid.ColumnSpan="2"
                               Text="自動整理與專案資料夾的根位置。未設定時會以桌面作為起點。"
                               Style="{StaticResource HintText}"/>
                </Grid>
            </GroupBox>

            <!-- 二、匯入 / HotFolder -->
            <GroupBox Header="匯入 / HotFolder" Margin="0,0,0,12">
                <Grid Style="{StaticResource FormGrid}">
                    <!-- 0: 拖放 / 子資料夾 -->
                    <TextBlock Grid.Row="0" Grid.Column="0" Text="拖放加入 / 子資料夾：" VerticalAlignment="Center"/>
                    <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal" Margin="{StaticResource FieldMargin}">
                        <CheckBox x:Name="CbAutoOnDrop" Content="拖放自動加入收件夾" Margin="0,0,16,0"/>
                        <CheckBox x:Name="CbIncludeSubdir" Content="包含子資料夾"/>
                    </StackPanel>
                    <TextBlock Grid.Row="1" Grid.ColumnSpan="2"
                               Text="拖放檔案是否自動加入 Inbox；加入資料夾時是否遞迴處理子資料夾。"
                               Style="{StaticResource HintText}"/>

                    <!-- 2: HotFolder -->
                    <TextBlock Grid.Row="2" Grid.Column="0" Text="HotFolder 路徑：" VerticalAlignment="Center"/>
                    <DockPanel Grid.Row="2" Grid.Column="1" Margin="{StaticResource FieldMargin}">
                        <TextBox x:Name="TxtHotFolder" Margin="0,0,8,0"/>
                        <Button Content="瀏覽…" Click="BtnPickHotFolder_Click" Style="{StaticResource TonedBtn}" MinWidth="76"/>
                    </DockPanel>
                    <TextBlock Grid.Row="3" Grid.ColumnSpan="2"
                               Text="監控資料夾：檔案放進此資料夾即視為收件夾（Inbox）。"
                               Style="{StaticResource HintText}"/>

                    <!-- 4: 搬檔/覆蓋策略 -->
                    <TextBlock Grid.Row="4" Grid.Column="0" Text="搬檔模式：" VerticalAlignment="Center"/>
                    <ComboBox x:Name="CbMoveMode" Grid.Row="4" Grid.Column="1" Margin="{StaticResource FieldMargin}"
                              ToolTip="移動：檔案搬到目的地；複製：保留原檔並複製到目的地。"
                              Width="180">
                        <!-- 0=Move, 1=Copy -->
                        <ComboBoxItem Content="移動（Move）"/>
                        <ComboBoxItem Content="複製（Copy）"/>
                    </ComboBox>
                    <TextBlock Grid.Row="5" Grid.ColumnSpan="2"
                               Text="選擇將檔案『移動』或『複製』到目的地。"
                               Style="{StaticResource HintText}"/>

                    <TextBlock Grid.Row="6" Grid.Column="0" Text="覆蓋策略：" VerticalAlignment="Center"/>
                    <ComboBox x:Name="CbOverwritePolicy" Grid.Row="6" Grid.Column="1" Margin="{StaticResource FieldMargin}"
                              ToolTip="目的地已存在同名檔案時的處理方式。" Width="180">
                        <!-- 0=Replace,1=Rename,2=Skip -->
                        <ComboBoxItem Content="取代（Replace）"/>
                        <ComboBoxItem Content="重新命名（Rename）"/>
                        <ComboBoxItem Content="略過（Skip）"/>
                    </ComboBox>
                    <TextBlock Grid.Row="7" Grid.ColumnSpan="2"
                               Text="同名衝突時：取代＝覆寫、重新命名＝在檔名後加序號、略過＝不搬。"
                               Style="{StaticResource HintText}"/>

                    <!-- 8: 黑名單（資料夾/副檔名） -->
                    <TextBlock Grid.Row="8" Grid.Column="0" Text="黑名單（資料夾）：" VerticalAlignment="Top"/>
                    <TextBox  x:Name="TxtBlacklistFolders" Grid.Row="8" Grid.Column="1" Height="70"
                              AcceptsReturn="True" VerticalScrollBarVisibility="Auto" Margin="{StaticResource FieldMargin}"/>
                    <TextBlock Grid.Row="9" Grid.ColumnSpan="2"
                               Text="要忽略的資料夾名稱；多筆以逗號或換行分隔。"
                               Style="{StaticResource HintText}"/>

                    <TextBlock Grid.Row="10" Grid.Column="0" Text="黑名單（副檔名）：" VerticalAlignment="Top"/>
                    <TextBox  x:Name="TxtBlacklistExts" Grid.Row="10" Grid.Column="1" Height="60"
                              AcceptsReturn="True" VerticalScrollBarVisibility="Auto" Margin="{StaticResource FieldMargin}"/>
                    <TextBlock Grid.Row="11" Grid.ColumnSpan="2"
                               Text="要忽略的副檔名，不含點；多筆以逗號或換行分隔。"
                               Style="{StaticResource HintText}"/>
                </Grid>
            </GroupBox>

            <!-- 三、路徑模板 -->
            <GroupBox Header="路徑模板（自動整理的資料夾階層）" Margin="0,0,0,12">
                <Grid Style="{StaticResource FormGrid}">
                    <TextBlock Grid.Row="0" Grid.ColumnSpan="2"
                               Text="勾選後會在目的地分層建立資料夾（例如：Root\2025\01\專案\類型）。"
                               Style="{StaticResource HintText}" Margin="0,0,0,6"/>
                    <StackPanel Grid.Row="1" Grid.ColumnSpan="2" Orientation="Horizontal">
                        <CheckBox x:Name="CbUseYear"    Content="年份（yyyy）" Margin="0,0,16,0"/>
                        <CheckBox x:Name="CbUseMonth"   Content="月份（MM）"  Margin="0,0,16,0"/>
                        <CheckBox x:Name="CbUseProject" Content="專案"        Margin="0,0,16,0"/>
                        <CheckBox x:Name="CbUseType"    Content="型態/類別"/>
                    </StackPanel>
                </Grid>
            </GroupBox>

            <!-- 四、LLM -->
            <GroupBox Header="LLM" Margin="0,0,0,12">
                <Grid Style="{StaticResource FormGrid}">
                    <TextBlock Grid.Row="0" Grid.Column="0" Text="API Key：" VerticalAlignment="Center"/>
                    <PasswordBox x:Name="TxtApiKey" Grid.Row="0" Grid.Column="1" Margin="{StaticResource FieldMargin}"/>
                    <TextBlock Grid.Row="1" Grid.ColumnSpan="2"
                               Text="OpenAI 之類的服務金鑰。留空則不啟用。"
                               Style="{StaticResource HintText}"/>

                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Model：" VerticalAlignment="Center"/>
                    <TextBox x:Name="TxtModel" Grid.Row="2" Grid.Column="1" Margin="{StaticResource FieldMargin}"/>
                    <TextBlock Grid.Row="3" Grid.ColumnSpan="2"
                               Text="模型名稱，例如 gpt-4o-mini。"
                               Style="{StaticResource HintText}"/>

                    <TextBlock Grid.Row="4" Grid.Column="0" Text="觸發條件：" VerticalAlignment="Center"/>
                    <CheckBox x:Name="CbLmLowConf" Grid.Row="4" Grid.Column="1" Margin="{StaticResource FieldMargin}"
                              Content="僅在低信心時啟用"/>
                    <TextBlock Grid.Row="5" Grid.ColumnSpan="2"
                               Text="打開後僅在分類信心不足時才呼叫 LLM。"
                               Style="{StaticResource HintText}"/>
                </Grid>
            </GroupBox>

            <!-- 五、主題 / 顏色 -->
            <GroupBox Header="主題 / 顏色（與 Theme.xaml 同步）" Margin="0,0,0,12">
                <Grid Margin="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- 左列：背景/文字 -->
                    <StackPanel Grid.Column="0" Margin="0,0,8,0">
                        <TextBlock Text="介面背景 / 邊框 / 文字" FontWeight="Bold"/>
                        <UniformGrid Columns="3" Margin="0,6,0,10">
                            <StackPanel>
                                <TextBlock Text="背景 Bg"/>
                                <DockPanel>
                                    <TextBox x:Name="TbBg" Width="110" Margin="0,0,6,0" TextChanged="ThemeTextBox_TextChanged"/>
                                    <Button Content="…" Width="32" Click="PickBg_Click" Style="{StaticResource TonedBtn}"/>
                                </DockPanel>
                                <Border x:Name="PrevBg" Height="22" BorderBrush="{DynamicResource App.BorderBrush}" BorderThickness="1"/>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="面板 Panel"/>
                                <DockPanel>
                                    <TextBox x:Name="TbPanel" Width="110" Margin="0,0,6,0" TextChanged="ThemeTextBox_TextChanged"/>
                                    <Button Content="…" Width="32" Click="PickPanel_Click" Style="{StaticResource TonedBtn}"/>
                                </DockPanel>
                                <Border x:Name="PrevPanel" Height="22" BorderBrush="{DynamicResource App.BorderBrush}" BorderThickness="1"/>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="邊框 Border"/>
                                <DockPanel>
                                    <TextBox x:Name="TbBorder" Width="110" Margin="0,0,6,0" TextChanged="ThemeTextBox_TextChanged"/>
                                    <Button Content="…" Width="32" Click="PickBorder_Click" Style="{StaticResource TonedBtn}"/>
                                </DockPanel>
                                <Border x:Name="PrevBorder" Height="22" BorderBrush="{DynamicResource App.BorderBrush}" BorderThickness="1"/>
                            </StackPanel>
                        </UniformGrid>

                        <TextBlock Text="文字 / 次色" FontWeight="Bold"/>
                        <UniformGrid Columns="3" Margin="0,6,0,0">
                            <StackPanel>
                                <TextBlock Text="文字 Text"/>
                                <DockPanel>
                                    <TextBox x:Name="TbText" Width="110" Margin="0,0,6,0" TextChanged="ThemeTextBox_TextChanged"/>
                                    <Button Content="…" Width="32" Click="PickText_Click" Style="{StaticResource TonedBtn}"/>
                                </DockPanel>
                                <Border x:Name="PrevText" Height="22" BorderBrush="{DynamicResource App.BorderBrush}" BorderThickness="1"/>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="文字（次）TextMuted"/>
                                <DockPanel>
                                    <TextBox x:Name="TbTextMuted" Width="110" Margin="0,0,6,0" TextChanged="ThemeTextBox_TextChanged"/>
                                    <Button Content="…" Width="32" Click="PickTextMuted_Click" Style="{StaticResource TonedBtn}"/>
                                </DockPanel>
                                <Border x:Name="PrevTextMuted" Height="22" BorderBrush="{DynamicResource App.BorderBrush}" BorderThickness="1"/>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="次色 Secondary"/>
                                <DockPanel>
                                    <TextBox x:Name="TbSecondary" Width="110" Margin="0,0,6,0" TextChanged="ThemeTextBox_TextChanged"/>
                                    <Button Content="…" Width="32" Click="PickSecondary_Click" Style="{StaticResource TonedBtn}"/>
                                </DockPanel>
                                <Border x:Name="PrevSecondary" Height="22" BorderBrush="{DynamicResource App.BorderBrush}" BorderThickness="1"/>
                            </StackPanel>
                        </UniformGrid>
                    </StackPanel>

                    <!-- 右列：主色/Banner/狀態 -->
                    <StackPanel Grid.Column="1" Margin="8,0,0,0">
                        <TextBlock Text="主要色 / Banner / 狀態色" FontWeight="Bold"/>
                        <UniformGrid Columns="3" Margin="0,6,0,10">
                            <StackPanel>
                                <TextBlock Text="主色 Primary"/>
                                <DockPanel>
                                    <TextBox x:Name="TbPrimary" Width="110" Margin="0,0,6,0" TextChanged="ThemeTextBox_TextChanged"/>
                                    <Button Content="…" Width="32" Click="PickPrimary_Click" Style="{StaticResource TonedBtn}"/>
                                </DockPanel>
                                <Border x:Name="PrevPrimary" Height="22" BorderBrush="{DynamicResource App.BorderBrush}" BorderThickness="1"/>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="主色 Hover"/>
                                <DockPanel>
                                    <TextBox x:Name="TbPrimaryHover" Width="110" Margin="0,0,6,0" TextChanged="ThemeTextBox_TextChanged"/>
                                    <Button Content="…" Width="32" Click="PickPrimaryHover_Click" Style="{StaticResource TonedBtn}"/>
                                </DockPanel>
                                <Border x:Name="PrevPrimaryHover" Height="22" BorderBrush="{DynamicResource App.BorderBrush}" BorderThickness="1"/>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="Banner Info"/>
                                <DockPanel>
                                    <TextBox x:Name="TbBannerInfo" Width="110" Margin="0,0,6,0" TextChanged="ThemeTextBox_TextChanged"/>
                                    <Button Content="…" Width="32" Click="PickBannerInfo_Click" Style="{StaticResource TonedBtn}"/>
                                </DockPanel>
                                <Border x:Name="PrevBannerInfo" Height="22" BorderBrush="{DynamicResource App.BorderBrush}" BorderThickness="1"/>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="Banner Warn"/>
                                <DockPanel>
                                    <TextBox x:Name="TbBannerWarn" Width="110" Margin="0,0,6,0" TextChanged="ThemeTextBox_TextChanged"/>
                                    <Button Content="…" Width="32" Click="PickBannerWarn_Click" Style="{StaticResource TonedBtn}"/>
                                </DockPanel>
                                <Border x:Name="PrevBannerWarn" Height="22" BorderBrush="{DynamicResource App.BorderBrush}" BorderThickness="1"/>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="Banner Error"/>
                                <DockPanel>
                                    <TextBox x:Name="TbBannerError" Width="110" Margin="0,0,6,0" TextChanged="ThemeTextBox_TextChanged"/>
                                    <Button Content="…" Width="32" Click="PickBannerError_Click" Style="{StaticResource TonedBtn}"/>
                                </DockPanel>
                                <Border x:Name="PrevBannerError" Height="22" BorderBrush="{DynamicResource App.BorderBrush}" BorderThickness="1"/>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="Success"/>
                                <DockPanel>
                                    <TextBox x:Name="TbSuccess" Width="110" Margin="0,0,6,0" TextChanged="ThemeTextBox_TextChanged"/>
                                    <Button Content="…" Width="32" Click="PickSuccess_Click" Style="{StaticResource TonedBtn}"/>
                                </DockPanel>
                                <Border x:Name="PrevSuccess" Height="22" BorderBrush="{DynamicResource App.BorderBrush}" BorderThickness="1"/>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="Warning"/>
                                <DockPanel>
                                    <TextBox x:Name="TbWarning" Width="110" Margin="0,0,6,0" TextChanged="ThemeTextBox_TextChanged"/>
                                    <Button Content="…" Width="32" Click="PickWarning_Click" Style="{StaticResource TonedBtn}"/>
                                </DockPanel>
                                <Border x:Name="PrevWarning" Height="22" BorderBrush="{DynamicResource App.BorderBrush}" BorderThickness="1"/>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="Error"/>
                                <DockPanel>
                                    <TextBox x:Name="TbError" Width="110" Margin="0,0,6,0" TextChanged="ThemeTextBox_TextChanged"/>
                                    <Button Content="…" Width="32" Click="PickError_Click" Style="{StaticResource TonedBtn}"/>
                                </DockPanel>
                                <Border x:Name="PrevError" Height="22" BorderBrush="{DynamicResource App.BorderBrush}" BorderThickness="1"/>
                            </StackPanel>
                        </UniformGrid>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="還原預設" Width="110" Margin="0,0,8,0" Click="ResetTheme_Click" Style="{StaticResource TonedBtn}"/>
                            <Button Content="套用並儲存" Width="120" Click="SaveTheme_Click" Style="{StaticResource PrimaryBtn}"/>
                        </StackPanel>
                    </StackPanel>
                </Grid>
            </GroupBox>

            <!-- 六、Extension Groups 檢視 / 匯入 -->
            <GroupBox Header="Extension Groups 檢視 / 匯入" Margin="0,0,0,12">
                <Grid Margin="12">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <DockPanel Grid.Row="0" LastChildFill="False">
                        <TextBlock Text="每組為『副檔名群組 → 列表』。按「整理為單行陣列」可把每個陣列壓成單行，方便閱讀/編輯。"
                                   Style="{StaticResource HintText}" Margin="0,0,12,0}"/>
                        <Button x:Name="BtnCompactExtGroups" Content="整理為單行陣列"
                                Click="BtnCompactExtGroups_Click" Style="{StaticResource TonedBtn}" Padding="8,4"/>
                    </DockPanel>

                    <TextBox x:Name="TxtExtGroups" Grid.Row="1"
                             AcceptsReturn="True"
                             VerticalScrollBarVisibility="Auto"
                             HorizontalScrollBarVisibility="Auto"
                             FontFamily="Consolas"
                             Height="220"
                             TextWrapping="NoWrap"/>
                </Grid>
            </GroupBox>

            <!-- 動作列 -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,8">
                <Button x:Name="BtnOk" Content="確定" Width="100" Margin="0,0,8,0"
                        Click="BtnOk_Click" Style="{StaticResource PrimaryBtn}"/>
                <Button Content="取消" Width="100" IsCancel="True" Style="{StaticResource TonedBtn}"/>
            </StackPanel>

        </StackPanel>
    </ScrollViewer>
</Window>