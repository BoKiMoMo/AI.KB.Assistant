<Window x:Class="AI.KB.Assistant.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="設定"
        Height="720" Width="980"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource App.BackgroundBrush}"
        Foreground="{DynamicResource App.TextBrush}">
    <DockPanel>

        <!-- 頂部標題 -->
        <Border DockPanel.Dock="Top" Padding="12"
                Background="{DynamicResource App.PanelBrush}"
                BorderBrush="{DynamicResource App.BorderBrush}" BorderThickness="0,0,0,1">
            <TextBlock Text="系統設定" FontSize="18" FontWeight="Bold"/>
        </Border>

        <!-- 底部動作列 -->
        <Border DockPanel.Dock="Bottom" Padding="12"
                Background="{DynamicResource App.PanelBrush}"
                BorderBrush="{DynamicResource App.BorderBrush}" BorderThickness="1,1,1,0">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button x:Name="BtnApplyTheme" Content="套用主題" Margin="0,0,8,0" Click="BtnApplyTheme_Click"/>
                <Button x:Name="BtnReload" Content="重新載入" Margin="0,0,8,0" Click="BtnReload_Click"/>
                <Button x:Name="BtnSave" Content="儲存" Margin="0,0,8,0" Click="BtnSave_Click"/>
                <Button x:Name="BtnCancel" Content="取消" Click="BtnCancel_Click"/>
            </StackPanel>
        </Border>

        <!-- 內容 -->
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <TabControl Margin="12">

                <!-- 基礎 -->
                <TabItem Header="基礎">
                    <Grid Margin="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="160"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="10"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="10"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Text="Root 目錄"/>
                        <TextBox x:Name="TxtRootDir" Grid.Row="0" Grid.Column="1" Margin="8,0,8,0"/>
                        <Button x:Name="BtnPickRoot" Grid.Row="0" Grid.Column="2" Content="瀏覽..." Width="90" Click="BtnPickRoot_Click"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" VerticalAlignment="Center" Text="收件夾 (HotFolder)"/>
                        <TextBox x:Name="TxtHotFolder" Grid.Row="2" Grid.Column="1" Margin="8,0,8,0"/>
                        <Button x:Name="BtnPickHot" Grid.Row="2" Grid.Column="2" Content="瀏覽..." Width="90" Click="BtnPickHot_Click"/>

                        <TextBlock Grid.Row="4" Grid.Column="0" VerticalAlignment="Center" Text="資料庫 (.db)"/>
                        <TextBox x:Name="TxtDbPath" Grid.Row="4" Grid.Column="1" Margin="8,0,8,0"/>
                        <Button x:Name="BtnPickDb" Grid.Row="4" Grid.Column="2" Content="選擇..." Width="90" Click="BtnPickDb_Click"/>
                    </Grid>
                </TabItem>

                <!-- 匯入 -->
                <TabItem Header="匯入">
                    <Grid Margin="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="220"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="10"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="10"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="10"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Text="匯入模式"/>
                        <ComboBox x:Name="CmbMoveMode" Grid.Row="0" Grid.Column="1" Margin="8,0,0,0" Width="200">
                            <ComboBoxItem Content="Move"/>
                            <ComboBoxItem Content="Copy"/>
                        </ComboBox>

                        <TextBlock Grid.Row="2" Grid.Column="0" VerticalAlignment="Center" Text="檔名衝突策略"/>
                        <ComboBox x:Name="CmbOverwritePolicy" Grid.Row="2" Grid.Column="1" Margin="8,0,0,0" Width="200">
                            <ComboBoxItem Content="Replace"/>
                            <ComboBoxItem Content="Rename"/>
                            <ComboBoxItem Content="Skip"/>
                        </ComboBox>

                        <CheckBox x:Name="ChkIncludeSubdir" Grid.Row="4" Grid.Column="1" Content="包含子資料夾"/>

                        <StackPanel Grid.Row="6" Grid.ColumnSpan="2">
                            <TextBlock Text="黑名單副檔名（逗號分隔，不含點）" Margin="0,0,0,6"/>
                            <TextBox x:Name="TxtBlacklistExts" AcceptsReturn="True" Height="60" TextWrapping="Wrap"/>
                        </StackPanel>
                    </Grid>
                </TabItem>

                <!-- 路由 -->
                <TabItem Header="路由">
                    <Grid Margin="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="220"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="10"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="10"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="10"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Text="自整理資料夾名稱"/>
                        <TextBox x:Name="TxtAutoFolderName" Grid.Row="0" Grid.Column="1" Margin="8,0,0,0" Width="240"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" VerticalAlignment="Center" Text="低信心資料夾名稱"/>
                        <TextBox x:Name="TxtLowConfidenceFolderName" Grid.Row="2" Grid.Column="1" Margin="8,0,0,0" Width="240"/>

                        <StackPanel Grid.Row="4" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="0,0,0,6">
                            <CheckBox x:Name="ChkUseYear" Content="年份層"/>
                            <CheckBox x:Name="ChkUseMonth" Content="月份層" Margin="16,0,0,0"/>
                            <CheckBox x:Name="ChkUseProject" Content="專案層" Margin="16,0,0,0"/>
                            <CheckBox x:Name="ChkUseType" Content="類型層" Margin="16,0,0,0"/>
                        </StackPanel>

                        <StackPanel Grid.Row="6" Grid.ColumnSpan="2">
                            <TextBlock Text="黑名單資料夾（逗號分隔）" Margin="0,0,0,6"/>
                            <TextBox x:Name="TxtBlacklistFolders" AcceptsReturn="True" Height="60" TextWrapping="Wrap"/>
                        </StackPanel>
                    </Grid>
                </TabItem>

                <!-- AI -->
                <TabItem Header="AI">
                    <Grid Margin="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="220"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="10"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="10"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="10"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Text="信心門檻 (0~1)"/>
                        <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal">
                            <Slider x:Name="SldThreshold" Minimum="0" Maximum="1" Width="240" ValueChanged="SldThreshold_ValueChanged"/>
                            <TextBlock x:Name="TxtThresholdValue" Margin="8,0,0,0" VerticalAlignment="Center" Text="0.75"/>
                        </StackPanel>

                        <TextBlock Grid.Row="2" Grid.Column="0" VerticalAlignment="Center" Text="OpenAI API Key"/>
                        <PasswordBox x:Name="TxtApiKey" Grid.Row="2" Grid.Column="1" Margin="8,0,0,0" Width="320"/>

                        <TextBlock Grid.Row="4" Grid.Column="0" VerticalAlignment="Center" Text="OpenAI Model"/>
                        <TextBox x:Name="TxtModel" Grid.Row="4" Grid.Column="1" Margin="8,0,0,0" Width="320"/>

                        <TextBlock Grid.Row="6" Grid.Column="0" VerticalAlignment="Center" Text="備註"/>
                        <TextBlock Grid.Row="6" Grid.Column="1" Margin="8,0,0,0"
                                   Foreground="{DynamicResource App.TextMutedBrush}"
                                   Text="僅在低信心時呼叫 LLM 產生建議；不會自動搬檔。"/>
                    </Grid>
                </TabItem>

                <!-- 主題 -->
                <TabItem Header="主題">
                    <Grid Margin="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="220"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="10"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Text="重點色（Hex）"/>
                        <TextBox x:Name="TxtAccentColor" Grid.Row="0" Grid.Column="1" Margin="8,0,0,0" Width="160"/>

                        <TextBlock Grid.Row="2" Grid.ColumnSpan="2"
                                   Foreground="{DynamicResource App.TextMutedBrush}"
                                   Text="提示：此頁僅示範重點色；完整配色由 ThemeColors 控制，請由 config.json 調整。"/>
                    </Grid>
                </TabItem>

            </TabControl>
        </ScrollViewer>
    </DockPanel>
</Window>
