<Window x:Class="AI.KB.Assistant.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        mc:Ignorable="d"
        Title="AI.KB.Assistant"
        Height="720" Width="1180"
        AllowDrop="True"
        Drop="Window_Drop"
        DragOver="Window_DragOver">

    <Window.Resources>

        <!-- 可用但目前未必需要；保留方便你在其他地方使用 -->
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>

        <!-- 共用按鈕樣式 -->
        <Style x:Key="HeaderBtn" TargetType="Button">
            <Setter Property="Margin" Value="4,0,0,0"/>
            <Setter Property="Padding" Value="10,4"/>
            <Setter Property="MinWidth" Value="72"/>
        </Style>

        <!-- 右側資訊欄的預設寬度 -->
        <GridLength x:Key="InfoWidth">320</GridLength>

        <!-- TextBox 水印（不需任何 converter） -->
        <Style TargetType="TextBox" x:Key="WatermarkBox">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Grid>
                            <ScrollViewer x:Name="PART_ContentHost"/>
                            <TextBlock x:Name="Watermark"
                                       Text="{TemplateBinding Tag}"
                                       Foreground="Gray"
                                       Margin="6,2,0,0"
                                       IsHitTestVisible="False"
                                       Visibility="Collapsed"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="Text" Value="">
                                <Setter TargetName="Watermark" Property="Visibility" Value="Visible"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

    </Window.Resources>

    <DockPanel>

        <!-- 頂端工具列 -->
        <ToolBar DockPanel.Dock="Top">
            <Button Style="{StaticResource HeaderBtn}" Content="加入檔案…" Click="BtnAddFiles_Click"/>
            <Button Style="{StaticResource HeaderBtn}" Content="開始分類（預覽）" Click="BtnStartClassify_Click"/>
            <Button Style="{StaticResource HeaderBtn}" Content="確認執行（搬檔）" Click="BtnCommit_Click"/>
            <Button Style="{StaticResource HeaderBtn}" Content="開啟收件夾" Click="BtnOpenInbox_Click"/>
            <Separator/>
            <Button Style="{StaticResource HeaderBtn}" Content="重新整理" Click="BtnRefresh_Click"/>
            <Separator/>
            <TextBlock VerticalAlignment="Center" Margin="6,0,4,0">目前鎖定專案：</TextBlock>
            <ComboBox x:Name="CbLockProject" Width="180" IsEditable="True"/>
            <Button Style="{StaticResource HeaderBtn}" Content="🔒/🔓 鎖定" Click="BtnLockProject_Click"/>
            <TextBox x:Name="TbProjectSearch" Width="140" Margin="8,0,0,0"
                     Style="{StaticResource WatermarkBox}" Tag="搜尋專案"/>
            <Button Style="{StaticResource HeaderBtn}" Content="搜尋專案" Click="BtnSearchProject_Click"/>
            <Separator/>
            <Button Style="{StaticResource HeaderBtn}" Content="設定" Click="BtnOpenSettings_Click"/>
            <Separator/>
            <Button Style="{StaticResource HeaderBtn}" Content="資訊" Click="BtnToggleRightPane_Click"/>
        </ToolBar>

        <!-- 主內容 -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="280"/>
                <ColumnDefinition Width="8"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="6"/>
                <ColumnDefinition x:Name="RightPaneColumn" Width="{StaticResource InfoWidth}"/>
            </Grid.ColumnDefinitions>

            <!-- 左：樹狀目錄 + 收合/展開 -->
            <DockPanel Grid.Column="0">
                <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="4">
                    <Button x:Name="BtnTreeToggle" Content="收合 / 展開" Click="BtnTreeToggle_Click"/>
                    <Button Content="收件夾" Margin="6,0,0,0" Click="BtnOpenInbox_Click"/>
                </StackPanel>

                <TreeView x:Name="TvFolders"
                          SelectedItemChanged="TvFolders_SelectedItemChanged"
                          MouseRightButtonUp="TvFolders_MouseRightButtonUp"/>
            </DockPanel>

            <GridSplitter Grid.Column="1" Width="8" Background="#EEE"/>

            <!-- 中：清單 -->
            <DockPanel Grid.Column="2">
                <TabControl x:Name="MainTabs" DockPanel.Dock="Top" SelectionChanged="MainTabs_SelectionChanged">
                    <TabItem Header="自整理" Tag="auto-sorted"/>
                    <TabItem Header="收件匣" Tag="inbox"/>
                    <TabItem Header="處理中" Tag="pending"/>
                    <TabItem Header="進行中" Tag="in-progress"/>
                    <TabItem Header="我的最愛" Tag="favorite"/>
                    <TabItem Header="最近三天" Tag="recent"/>
                </TabControl>

                <StackPanel>
                    <!-- 路徑麵包屑，可收合 -->
                    <StackPanel Orientation="Horizontal" Margin="4" x:Name="PathStrip"/>
                    <ListView x:Name="FileList"
                              Margin="4"
                              SelectionMode="Extended"
                              ContextMenuOpening="FileList_ContextMenuOpening"
                              PreviewMouseDoubleClick="FileList_PreviewMouseDoubleClick"
                              KeyDown="FileList_KeyDown"
                              SelectionChanged="FileList_SelectionChanged">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="#" Width="40" DisplayMemberBinding="{Binding Id}"/>
                                <GridViewColumn Header="檔名" Width="360" DisplayMemberBinding="{Binding Filename}"/>
                                <GridViewColumn Header="類型" Width="80" DisplayMemberBinding="{Binding Ext}"/>
                                <GridViewColumn Header="專案" Width="140" DisplayMemberBinding="{Binding Project}"/>
                                <GridViewColumn Header="分類" Width="140" DisplayMemberBinding="{Binding Category}"/>
                                <GridViewColumn Header="狀態" Width="120" DisplayMemberBinding="{Binding Status}"/>
                            </GridView>
                        </ListView.View>
                        <ListView.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="開啟檔案" Click="CtxOpenFile_Click"/>
                                <MenuItem Header="在檔案總管開啟所在資料夾" Click="CtxOpenFolder_Click"/>
                                <Separator/>
                                <MenuItem Header="指定專案…" Click="CtxSetProject_Click"/>
                                <MenuItem Header="AI 建議專案…" Click="BtnSuggestProject_Click"/>
                                <MenuItem Header="設定標籤…" Click="CtxSetTags_Click"/>
                                <Separator/>
                                <MenuItem Header="複製路徑" Click="CtxCopyPath_Click"/>
                            </ContextMenu>
                        </ListView.ContextMenu>
                    </ListView>
                </StackPanel>
            </DockPanel>

            <GridSplitter Grid.Column="3" Width="6" Background="#EEE"/>

            <!-- 右：資訊欄（用 Border 提供 Padding，避免 StackPanel Padding 錯誤） -->
            <Border Grid.Column="4" x:Name="InfoPane" BorderBrush="#DDD" BorderThickness="1,0,0,0">
                <DockPanel>
                    <Border DockPanel.Dock="Top" Background="#FAFAFA" Padding="6">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="資訊" FontWeight="Bold" VerticalAlignment="Center"/>
                            <Button Content="收合" Margin="8,0,0,0" Click="BtnToggleRightPane_Click"/>
                        </StackPanel>
                    </Border>

                    <StackPanel Margin="8" x:Name="InfoBody">
                        <!-- 空狀態 -->
                        <StackPanel x:Name="InfoEmpty">
                            <TextBlock Text="提示：" FontWeight="Bold"/>
                            <TextBlock Text="　選取中間清單的檔案，這裡會顯示詳細資訊與快捷操作。"/>
                            <TextBlock Text="　也可在左側樹狀圖按右鍵：「在檔案總管開啟」或「將此資料夾設為分類根目錄」。"/>
                        </StackPanel>

                        <!-- 詳細資訊 -->
                        <StackPanel x:Name="InfoDetail" Visibility="Collapsed" Margin="0,4,0,0">
                            <TextBlock x:Name="InfoName" FontWeight="Bold" FontSize="14"/>
                            <TextBlock x:Name="InfoPath" TextWrapping="Wrap" Margin="0,2,0,0"/>
                            <UniformGrid Columns="2" Margin="0,6,0,0">
                                <StackPanel>
                                    <TextBlock Text="大小：" FontWeight="Bold"/>
                                    <TextBlock x:Name="InfoSize"/>
                                </StackPanel>
                                <StackPanel>
                                    <TextBlock Text="建立時間：" FontWeight="Bold"/>
                                    <TextBlock x:Name="InfoCreated"/>
                                </StackPanel>
                                <StackPanel>
                                    <TextBlock Text="專案：" FontWeight="Bold"/>
                                    <TextBlock x:Name="InfoProject"/>
                                </StackPanel>
                                <StackPanel>
                                    <TextBlock Text="分類：" FontWeight="Bold"/>
                                    <TextBlock x:Name="InfoCategory"/>
                                </StackPanel>
                                <StackPanel>
                                    <TextBlock Text="狀態：" FontWeight="Bold"/>
                                    <TextBlock x:Name="InfoStatus"/>
                                </StackPanel>
                                <StackPanel>
                                    <TextBlock Text="標籤：" FontWeight="Bold"/>
                                    <TextBlock x:Name="InfoTags" TextWrapping="Wrap"/>
                                </StackPanel>
                            </UniformGrid>

                            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                <Button Content="開啟檔案" Click="CtxOpenFile_Click" Margin="0,0,6,0"/>
                                <Button Content="開啟所在資料夾" Click="CtxOpenFolder_Click" Margin="0,0,6,0"/>
                                <Button Content="複製路徑" Click="CtxCopyPath_Click"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </DockPanel>
            </Border>
        </Grid>

        <!-- 底部日誌 -->
        <DockPanel DockPanel.Dock="Bottom" LastChildFill="True" Height="140">
            <TextBox x:Name="LogBox"
                     FontFamily="Consolas" FontSize="12"
                     TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"
                     IsReadOnly="True" Margin="4"/>
        </DockPanel>
    </DockPanel>
</Window>
